{% extends 'profile_base.html' %}
{% load static %}
{% block content %}
<style>
    .btn{
        white-space: nowrap;
        text-align : center;
    }
</style>
<body class="profile">
<div class="container-fluid newsfeed d-flex" id="wrapper">
    <div class="row newsfeed-size">
        <div class="col-md-12 p-0">
            {% include 'navbar_base.html' %}
            <div class="row profile-right-side-content">
                <div class="user-profile">
                    <div class="profile-header-background">
                        <a href="#" class="profile-cover">
                            <img src="{% static 'assets/images/users/cover/cover-1.gif' %}"
                                 alt="Profile Header Background">
                        </a>
                    </div>
                    <div class="row profile-rows">
                        <div class="col-md-3">
                            <div class="profile-info-left">
                                <div class="text-center">
                                    <div class="profile-img w-shadow">

                                        <img src="{{ User_Profile.profile_pic.url}}" alt="Avatar"
                                             class="avatar img-circle img-fluid" style="object-fit:contain;">
                                        <div class="profile-img-caption">
                                        </div>
                                    </div>
                                    <p class="profile-fullname mt-3">{{User_Profile.first_name}}
                                        {{User_Profile.last_name}}</p>
                                    <p class="profile-username mb-3 text-muted">@{{User_Profile.username}}</p>
                                </div>

                                {% if User_Profile != request.user %}
                                <div class="intro mt-4">
                                    <div class="d-flex">
                                        {% if Following %}
                                        <form method="GET" action="/follow-unfollow-user">
                                            <input hidden value='{{User_Profile.username}}' name="username">
                                            <button type="submit" style="border-radius:50px;"
                                                    class="btn btn-md btn-outline-success mr-3">Following
                                            </button>

                                        </form>
                                        {% else %}
                                        <form method="GET" action="/follow-unfollow-user">
                                            <input hidden value='{{User_Profile.username}}' name="username">
                                            <button type="submit" class="btn btn-outline-primary btn-md mr-3"
                                                    style="border-radius:50px"><i
                                                    class="bx bx-plus"></i>
                                                Follow
                                            </button>
                                        </form>
                                        {% endif %}

                                        {% if Friend_Request_Sent %}
                                        <form action="/send-friend-request" method="GET">
                                            <input hidden name="addfriend_username"
                                                   value="{{searched_user.username}}">
                                            <button type="submit" class="btn btn-primary btn-md"
                                                    style="border-radius:50px;font-size:0.9rem;"><i
                                                    class='bx bx-user-check'></i>
                                                Request sent
                                            </button>
                                        </form>

                                        {% endif %}

                                        {% if not Friend and not Friend_Request_Sent %}
                                        <form method="GET" action='/send-friend-request'>
                                            <input hidden name="addfriend_username" value="{{User_Profile.username}}">
                                            <button type="submit" class="btn btn-primary btn-md"
                                                    style="border-radius:50px;"
                                            ><i class='bx bx-user-plus'></i>
                                                <span>Add friend</span>
                                            </button>
                                        </form>
                                        {% else %}
                                        <form method="GET" action='/unfriend'>
                                            <input hidden name="username"
                                                   value="{{User_Profile.username}}">
                                            <button type="submit" class="btn btn-primary btn-md"
                                                    style="border-radius:50px;"
                                            ><i class='bx bx-user-x'></i>
                                                Unfriend
                                            </button>
                                        </form>
                                        {% endif %}


                                        <button type="button" class="btn btn-follow" id="moreMobile"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i
                                                class='bx bx-dots-horizontal-rounded'></i> <span
                                                class="fs-8">More</span></button>
                                        <div class="dropdown-menu dropdown-menu-right profile-ql-dropdown"
                                             aria-labelledby="moreMobile">
                                            <a href="/" class="dropdown-item">Timeline</a>
                                            <a href="/" class="dropdown-item">About</a>
                                            <a href="/" class="dropdown-item">Followers</a>
                                            <a href="/" class="dropdown-item">Following</a>
                                            <a href="/" class="dropdown-item">Photos</a>
                                            <a href="/" class="dropdown-item">Videos</a>
                                            <a href="/" class="dropdown-item">Check-Ins</a>
                                            <a href="/" class="dropdown-item">Events</a>
                                            <a href="/" class="dropdown-item">Likes</a>
                                        </div>
                                    </div>

                                </div>
                                {% endif %}

                                <div class="intro mt-5 mv-hidden p-4">
                                    <div class="intro-item d-flex justify-content-between align-items-center">
                                        <h3 class="intro-about">Intro</h3>
                                    </div>
                                    <div class="intro-item d-flex justify-content-between align-items-center">
                                        {% if User_Profile.job|length != 0%}
                                        <p class="intro-title text-muted"><i class='bx bx-briefcase text-primary'></i>
                                            Job <a href="#">{{ User_Profile.job }}</a></p>
                                        {% endif %}
                                    </div>
                                    <div class="intro-item d-flex justify-content-between align-items-center">
                                        <p class="intro-title text-muted"><i class='bx bx-map text-primary'></i> Lives
                                            in <a href="#">{{User_Profile.city}}, {{User_Profile.country}}</a></p>
                                    </div>
                                    <div class="intro-item d-flex justify-content-between align-items-center">
                                        <p class="intro-title text-muted"><i class='bx bx-time text-primary'></i> Last
                                            Login
                                            {% if User_Profile.online %}
                                            <a href="#">Online <span class="ml-1 online-status bg-success"></span></a>
                                            {% else %}
                                            <a href="#">Offline <span
                                                    class="ml-1 online-status bg-secondary"></span></a>
                                        </p>
                                        {% endif %}
                                    </div>
                                    {% if request.user == User_Profile %}
                                    <div class="intro-item d-flex justify-content-between align-items-center">
                                        <a href="{% url 'basic-settings' %}"
                                           class="btn btn-quick-link join-group-btn border w-100">Edit
                                            Details</a>
                                    </div>
                                    {% endif %}
                                </div>

                            </div>
                        </div>


                        <div class="col-md-9 p-0">
                            <div class="profile-info-right">

                                <!-- Posts section -->
                                <div class="row">
                                    <div class="col-md-9 profile-center">
                                        <ul class="list-inline profile-links d-flex justify-content-between w-shadow rounded">
                                            <li class="list-inline-item profile-active">
                                                <a href="/profile/{{User_Profile.username}}">Timeline</a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="/profile/{{User_Profile.username}}/about">About</a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="friends.html">Friends</a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="#">Photos</a>
                                            </li>
                                            <li class="list-inline-item dropdown">
                                                <a href="#" data-toggle="dropdown" aria-haspopup="true"
                                                   aria-expanded="false">
                                                    <i class='bx bx-dots-vertical-rounded'></i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right profile-ql-dropdown">
                                                    <a href="#" class="dropdown-item">Activity Log</a>
                                                    <a href="#" class="dropdown-item">Videos</a>
                                                    <a href="#" class="dropdown-item">Check-Ins</a>
                                                    <a href="#" class="dropdown-item">Events</a>
                                                    <a href="#" class="dropdown-item">Likes</a>
                                                </div>
                                            </li>
                                        </ul>

                                        <div class="bg-white profile-posts-options mt-5 mb-4 py-3 d-flex justify-content-between shadow-sm">
                                            <div class="col-md-3 col-sm-12">
                                                <h6 class="timeline-title">Saved Posts</h6>
                                            </div>
                                            <div class="col-md-9 col-sm-12">
                                                <div class="timeline-manage">
                                                    <button type="button"
                                                            class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons">
                                                        <i class='bx bxs-cog'></i> Manage Posts
                                                    </button>
                                                    <button type="button"
                                                            class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons">
                                                        <i class='bx bx-align-middle'></i> List View
                                                    </button>
                                                    <button type="button"
                                                            class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons">
                                                        <i class='bx bxs-grid-alt'></i> Grid View
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="col-md-9 col-sm-12" style="display:none;">
                                                <div class="timeline-manage">
                                                    <button type="button"
                                                            class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons">
                                                        <i class='bx bxs-cog'></i> Manage Posts
                                                    </button>
                                                    <button type="button"
                                                            class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons">
                                                        <i class='bx bx-align-middle'></i> List View
                                                    </button>
                                                    <button type="button"
                                                            class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons">
                                                        <i class='bx bxs-grid-alt'></i> Grid View
                                                    </button>
                                                </div>
                                            </div>

                                        </div>

                                        {% if Saved_Posts.count == 0 %}
                                        <div class="bg-white profile-posts-options mt-5 mb-4 py-3 d-flex justify-content-between shadow-sm">
                                            <div class="col-md-12 ">
                                                <h5 class="timeline-title text-muted">You can save posts in this
                                                    area</h5>
                                            </div>
                                        </div>

                                        {% endif %}

                                        <!--  saved Post Starts Here-->
                                        {% for post in Saved_Posts %}
                                        <div class="post border-bottom p-3 bg-white w-shadow">
                                            <div class="media text-muted pt-3">
                                                <img src="{{ post.user.profile_pic.url }}" alt="Online user"
                                                     class="mr-3 post-user-image">
                                                <div class="media-body pb-3 mb-0 small lh-125">
                                                    <div class="d-flex justify-content-between align-items-center w-100">
                                                        <span class="post-type text-muted"><a href="#" class="text-gray-dark post-user-name mr-2">{{post.user.first_name}} {{post.user.last_name}}</a></span>
                                                        <div class="dropdown">
                                                            <a href="#" class="post-more-settings" role="button"
                                                               data-toggle="dropdown" id="postOptions"
                                                               aria-haspopup="true" aria-expanded="false">
                                                                <i class='bx bx-dots-horizontal-rounded'></i>
                                                            </a>
                                                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg-left post-dropdown-menu">
<!--                                                                Unsaving post-->
                                                                <a role="button" href="#" class="dropdown-item"
                                                                   aria-describedby="hidePost">
                                                                    <div class="row"
                                                                         onclick="location.href = '/posts/save-unsave-post/{{post.slug}}'">
                                                                        <div class="col-md-2">
                                                                            <i class='bx bx-hide post-option-icon'></i>
                                                                        </div>
                                                                        <div class="col-md-10">
                                                                            <span class="fs-9">Unsave post</span>
                                                                            <small id="hidePost"
                                                                                   class="form-text text-muted">remove
                                                                                this post from saved</small>
                                                                        </div>
                                                                    </div>
                                                                </a>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <span class="d-block">{{ post.created_at }}  · <i
                                                            class='bx bxs-group '></i></span>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <p>{{post.description}}</p>
                                            </div>
                                            {% if post.post_image or post.post_video %}
                                            <div class="d-block mt-3">
                                                {% if post.post_image %}
                                                <img src="{{post.post_image.url}}"
                                                     class="w-100 mb-3" alt="post image">
                                                {% else %}
                                                <video id="my_video_post" class="video-js vjs-default-skin post-content"
                                                       width="640px" height="400px" controls
                                                       data-setup='{ "aspectRatio":"640:400", "playbackRates": [1, 1.5, 2] }'>
                                                    <source src="{{post.post_video.url}}" type='video/mp4'/>

                                                </video>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                            <div class="mb-2">

                                                <!-- Reactions -->
                                                {% include 'reaction_base.html' %}


                                                <a href="javascript:void(0)" class="post-card-buttons"
                                                   id="show-comments-{{post.slug}}">
                                                    <button class="btn"><img
                                                            src="{% static 'assets/images/icons/reactions/comments.png' %}"
                                                            style="width:28px;height:28px;"></button>
                                                    {{ post.Post_Comments.count }}
                                                </a>

                                                <script>
                                                    // Show comment section
                                                    $(document).ready(function () {
                                                    $('#show-comments-{{post.slug}}').click(function () {
                                                    $('#hide-comments-{{post.slug}}').slideToggle("slow");
                                                    // Alternative animation for example
                                                    // slideToggle("fast");
                                                    });
                                                    });
                                                </script>

                                                <div class="dropdown dropup share-dropup">
                                                    <a href="#" class="post-card-buttons" data-toggle="dropdown"
                                                       aria-haspopup="true" aria-expanded="false">
                                                        <i class='bx bx-share-alt mr-2'></i> Share
                                                    </a>
                                                    <div class="dropdown-menu post-dropdown-menu">
                                                        <a href="#" class="dropdown-item">
                                                            <div class="row">
                                                                <div class="col-md-2">
                                                                    <i class='bx bx-share-alt'></i>
                                                                </div>
                                                                <div class="col-md-10">
                                                                    <span>Share Now (Public)</span>
                                                                </div>
                                                            </div>
                                                        </a>
                                                        <a href="#" class="dropdown-item">
                                                            <div class="row">
                                                                <div class="col-md-2">
                                                                    <i class='bx bx-share-alt'></i>
                                                                </div>
                                                                <div class="col-md-10">
                                                                    <span>Share...</span>
                                                                </div>
                                                            </div>
                                                        </a>
                                                        <a href="#" class="dropdown-item">
                                                            <div class="row">
                                                                <div class="col-md-2">
                                                                    <i class='bx bx-message'></i>
                                                                </div>
                                                                <div class="col-md-10">
                                                                    <span>Send as Message</span>
                                                                </div>
                                                            </div>
                                                        </a>
                                                    </div>
                                                </div>

                                                <!--            Comment Sections-->
                                                <div class="border-top pt-3 " id="hide-comments-{{post.slug}}"
                                                     style="display: none;">
                                                    <div class="row bootstrap snippets">
                                                        <div class="col-md-12">
                                                            <div class="comment-wrapper">
                                                                <div class="panel panel-info">
                                                                    <div class="panel-body">
                                                                        <ul class="media-list comments-list">
                                                                            <li class="media comment-form">
                                                                                <a href="/profile/{{request.user.username}}"
                                                                                   class="pull-left">
                                                                                    <img src="{{request.user.profile_pic.url }}"
                                                                                         alt="" class="img-circle">
                                                                                </a>
                                                                                <div class="media-body">
                                                                                    <form action="{% url 'post-comment' post.slug %}"
                                                                                          method="POST" role="form">
                                                                                        {% csrf_token %}
                                                                                        <div class="row">
                                                                                            <div class="col-md-12">
                                                                                                <div class="input-group">
                                                                                                    <input type="text"
                                                                                                           name="comment"
                                                                                                           required
                                                                                                           class="form-control comment-input"
                                                                                                           placeholder="Write a comment...">

                                                                                                    <div class="input-group-btn">
                                                                                                        <button type="submit"
                                                                                                                class="btn comment-form-btn"
                                                                                                                data-toggle="tooltip"
                                                                                                                data-placement="top"
                                                                                                                title="Tooltip on top">
                                                                                                            <i class='bx bxs-paper-plane'></i>
                                                                                                        </button>
                                                                                                        <button type="button"
                                                                                                                class="btn comment-form-btn comment-form-btn"
                                                                                                                data-toggle="tooltip"
                                                                                                                data-placement="top"
                                                                                                                title="Tooltip on top">
                                                                                                            <i class='bx bx-camera'></i>
                                                                                                        </button>
                                                                                                        <button type="button"
                                                                                                                class="btn comment-form-btn comment-form-btn"
                                                                                                                data-toggle="tooltip"
                                                                                                                data-placement="top"
                                                                                                                title="Tooltip on top">
                                                                                                            <i class='bx bx-microphone'></i>
                                                                                                        </button>
                                                                                                        <button type="button"
                                                                                                                class="btn comment-form-btn"
                                                                                                                data-toggle="tooltip"
                                                                                                                data-placement="top"
                                                                                                                title="Tooltip on top">
                                                                                                            <i class='bx bx-file-blank'></i>
                                                                                                        </button>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>
                                                                                </div>
                                                                            </li>
                                                                            <!--                                            All Comments -->

                                                                            {% for post_comment in post.Post_Comments %}

                                                                            <li class="media">
                                                                                <a href="/profile/{{post_comment.user.username}}"
                                                                                   class="pull-left">
                                                                                    <img src="{{post_comment.user.profile_pic.url}}"
                                                                                         alt="" class="img-circle">
                                                                                </a>
                                                                                <div class="media-body">
                                                                                    <div class="d-flex justify-content-between align-items-center w-100">
                                                                                        <strong class="text-gray-dark">
                                                                                            <a href="/profile/{{post_comment.user.username}}"
                                                                                               class="fs-8">
                                                                                                {{post_comment.user.username
                                                                                                }}</a></strong>
                                                                                    </div>
                                                                                    <span class="d-block comment-created-time">{{ post_comment.created_at }}</span>


                                                                                    <!--                                                Edit Comment-->
                                                                                    {% if request.user == post_comment.user %}
                                                                                    <form action="/posts/edit-comment/{{post.slug}}/{{post_comment.id}}"
                                                                                          method="POST">
                                                                                        {% csrf_token %}
                                                                                        <div class="input-group mt-2 mb-2">

                                                                                            <input type="text"
                                                                                                   class="form-control comment-input"
                                                                                                   name='edit-comment'
                                                                                                   value="{{post_comment.comment}}"
                                                                                                   placeholder="Edit your comment">
                                                                                            <div class="input-group-btn">
                                                                                                <button type="submit"
                                                                                                        class="btn comment-form-btn"
                                                                                                        data-toggle="tooltip"
                                                                                                        data-placement="top"
                                                                                                        title="Tooltip on top">
                                                                                                    <i class='bx bxs-paper-plane'></i>
                                                                                                </button>
                                                                                                <button type="button"
                                                                                                        onclick="location.href = '/posts/delete-comment/{{post.slug}}/{{post_comment.id}}'"
                                                                                                        class="btn comment-form-btn"
                                                                                                        data-toggle="tooltip"
                                                                                                        data-placement="top"
                                                                                                        title="Tooltip on top">
                                                                                                    <i class='bx bxs-trash'></i>
                                                                                                </button>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>
                                                                                    {% else %}
                                                                                    <p class="fs-8 pt-2"
                                                                                       id='post_description_{{post_comment.slug}}_{{post_comment.id}}'>
                                                                                        {{ post_comment.comment }}
                                                                                    </p>
                                                                                    {% endif %}
                                                                                    <div class="commentLR">
                                                                                        <button type="button"
                                                                                                class="btn btn-link fs-8">
                                                                                            Like
                                                                                        </button>
                                                                                        <button type="button"
                                                                                                class="btn btn-link fs-8">
                                                                                            Reply
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                            </li>

                                                                            {% endfor %}
<!--Saved Posts Sections ends-->
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

